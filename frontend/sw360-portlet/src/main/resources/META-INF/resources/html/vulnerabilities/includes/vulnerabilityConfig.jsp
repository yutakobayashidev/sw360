<%--
  ~ Copyright TOSHIBA CORPORATION, 2022. Part of the SW360 Portal Project.
  ~ Copyright Toshiba Software Development (Vietnam) Co., Ltd., 2022. Part of the SW360 Portal Project.
  ~
  ~ This program and the accompanying materials are made
  ~ available under the terms of the Eclipse Public License 2.0
  ~ which is available at https://www.eclipse.org/legal/epl-2.0/
  ~
  ~ SPDX-License-Identifier: EPL-2.0
  --%>
<%@ page import="javax.portlet.PortletRequest" %>
<%@ page import="com.liferay.portal.kernel.portlet.PortletURLFactoryUtil" %>
<%@ page import="com.liferay.portal.kernel.util.PortalUtil" %>
<%@ page import="org.eclipse.sw360.datahandler.thrift.vulnerabilities.Vulnerability" %>
<table id="vulnerabilityConfiguration" class="table edit-table two-columns-with-actions">
     <thead>
         <tr>
            <th colspan="3"><liferay-ui:message key="vulnerability.configuration" /></th>
         </tr>
     </thead>
     <tbody>
         <tr style="display:none" class="configurationRow">
             <td>
                  <div class="form-group">
                       <input type="text"  class="form-control config-key" placeholder="<liferay-ui:message key="enter.vulnerability.configuration.key" />"
                            name="<portlet:namespace/><%=PortalConstants.VULNERABILITY_CONFIG_KEY%>" />
                       <div class="invalid-feedback">
                            <liferay-ui:message key="please.enter.vulnerability.configuration.key" />
                       </div>
                  </div>
             </td>
             <td>
                  <div class="form-group">
                       <input type="text" class="form-control config-value" placeholder="<liferay-ui:message key="enter.vulnerability.configuration.value" />"
                            name="<portlet:namespace/><%=PortalConstants.VULNERABILITY_CONFIG_VALUE%>" />
                       <div class="invalid-feedback">
                            <liferay-ui:message key="please.enter.vulnerability.configuration.value" />
                       </div>
                  </div>
                  </td>
                   <td class="content-middle">
                        <svg class="action lexicon-icon delete-config-btn">
                             <title>Delete</title>
                                 <use href="/o/org.eclipse.sw360.liferay-theme/images/clay/icons.svg#trash"/>
                        </svg>
                   </td>
         </tr>

         <core_rt:if test="${not addMode}" >
              <core_rt:forEach var="configuration" items="${vulnerability.vulnerableConfiguration}" varStatus="loop">
                   <tr class="configurationRow">
                         <td>
                              <div class="form-group">
                                  <input type="text" class="form-control config-key" placeholder="<liferay-ui:message key="enter.vulnerability.configuration.key" />"
                                         value="<sw360:out value='${configuration.key}'/>"
                                         name="<portlet:namespace/><%=PortalConstants.VULNERABILITY_CONFIG_KEY%>" />
                                  <div class="invalid-feedback">
                                       <liferay-ui:message key="please.enter.vulnerability.configuration.key" />
                                  </div>
                              </div>
                         </td>
                         <td>
                              <div class="form-group">
                                   <input type="text" class="form-control config-value" placeholder="<liferay-ui:message key="enter.vulnerability.configuration.value" />"
                                        value="<sw360:out value='${configuration.value}'/>"
                                        name="<portlet:namespace/><%=PortalConstants.VULNERABILITY_CONFIG_VALUE%>" />
                                   <div class="invalid-feedback">
                                        <liferay-ui:message key="please.enter.vulnerability.configuration.value" />
                                   </div>
                              </div>
                         </td>
                         <td class="content-middle">
                              <svg class="action lexicon-icon delete-config-btn">
                                   <title>Delete</title>
                                   <use href="/o/org.eclipse.sw360.liferay-theme/images/clay/icons.svg#trash"/>
                              </svg>
                         </td>
                   </tr>
              </core_rt:forEach>
         </core_rt:if>
     </tbody>
</table>
<button type="button" class="btn btn-secondary" id="add-configuration-btn">
    <liferay-ui:message key="click.to.add.vulnerability.configuration" />
</button>

<%@ include file="/html/utils/includes/requirejs.jspf" %>
<script>
    require(['jquery'], function($) {
        //======================Vulnerability Configuration=========================//
        $('.delete-config-btn').on('click',deleteConfigRow);

        $('#add-configuration-btn').on('click', function() {
            if ($('.configurationRow').last().css('display') == 'none') {
            $('.configurationRow').first().css('display', 'table-row');
                return;
            }
            let newRow = $(".configurationRow").last().clone().css('display','table-row');
            $('#vulnerabilityConfiguration').find('tbody').append(newRow);
            $('.config-key').last().val('');
            $('.config-value').last().val('');
            $('.delete-config-btn').last().bind('click', deleteConfigRow);
        });

        function deleteConfigRow() {
            if ($('.delete-config-btn').length > 1) {
                 $(this).closest('tr').remove();
            } else {
                $('.config-key').last().val('');
                $('.config-value').last().val('');
                $(this).closest('tr').css('display', 'none');
            }
        }
    });
</script>